# ---------------------------------------------------------------
# Assembly language program that reads data from the switches
# and displays it on the LEDs.
# ---------------------------------------------------------------

.text

# define a macro to move a 32 bit address to a register

.macro MOVIA reg, addr
  movhi \reg, %hi(\addr)
  ori \reg, \reg, %lo(\addr)
.endm

# define constants
.equ PB,    0x11010    #base address of pushbuttons in the system.h file
.equ HEX0,  0x11000    #base address of HEX0 in the system.h file
.equ PRESS, 0x0000D    #value for key1 being pressed (0b1101)

#Define the main program
.global main
main: 	#load r2, r3, and r6 with the addresses
  		movia r2, PB
  		movia r3, HEX0
		movia r6, PRESS

  		addi r5, r0, 0x40  #write to r5
  		stbio r5, 0(r3)	   #write 0 to HEX0

loop:
		ldbio r4, 0(r2)  #read value at pushbutton address to r4
		beq r4,r6, PRESS  #if key1 pressed (r4 is 0b1101), jump to PRESS

		br loop

PRESS:
		call	WAIT  #wait for pushbutton to be released

WAIT:
		bne r4,r6, #wait for key1 to be released
